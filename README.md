# Лабораторная работа 3. Уровень 2.

В  лабораторной  работе  в  классе  **V1DataArray**  надо  использовать  интерполяционные кубические сплайны из математической библиотеки **Intel MKL** для аппроксимации данных измерений  с  помощью  одномерных  интерполяционных  кубических  сплайнов  и  пересчета данных измерений электромагнитного поля на более мелкую сетку,  

В  классе  **V1DataArray**  из  лабораторной  работы  2  данные  измерений  на  двумерной прямоугольной  сетке  с  равномерным  шагом  по  осям  Ox  и  Oy  хранятся  в  двумерном прямоугольном массиве типа **Complex[,].** В классе хранятся параметры сетки − шаг $h_x$ по оси 

Ox, шаг $h_y$ по оси Oy, число узлов $n_x$ по оси Ox, число узлов $n_y$ по оси Oy. Предполагается, что координаты первых узлов сетки по осям Ox и Oy равны нулю.  

Можно  рассматривать  эти  данные  как  комплексную  функцию  двух  действительных переменных (*x*,*y*), значения которой известны только в узлах прямоугольной сетки.  

Эти же данные можно рассматривать как действительную векторную функцию 

$`F(x) =`$ {$`F_0^{Re}(x), F_0^{Im}(x), F_1^{Re}(x), F_1^{Im}(x),... F_{n_Y - 1}^{Re}(x), F_{n_Y - 1}^{Im}(x)`$}

одной  действительной  переменной  *x*,  значения  которой  известны  только  в  узлах одномерной сетки $`x_j = j×h_x, j = 0,1,...(n_x − 1)`$. Нижний индекс элемента $F_k$ векторной 
функции − это второй индекс узла прямоугольной сетки (по оси Oy).    

Для того, чтобы пересчитать данные измерений электромагнитного поля на более мелкую сетку  по  оси  Ox,  для  всех  элементов  векторной  функции  $`F_k^{Re}, F_k^{Im}, k =0,1,...(n_y − 1)`$
строятся  интерполяционные  кубические  сплайны  с  узлами  в  точках $`x_j = j×h_x, j = 0,1,...(n_x −1)`$. 

## Требования к программе.

Добавить в класс **V1DataArray** открытые методы:  

- **Complex?** **FieldAt (int jx, int jy)**, который возвращает комплексное значение  поля в узле сетки с индексами **[ jx , jy ]**. Если значения индексов выходят за границы допустимых значений, метод возвращает значение **null**.  
- **bool Max\_Field\_Re (int jy, ref double min, ref double max)**, который вычисляет минимальное и максимальное значения действительной части поля в узлах сетки, для которых значение второго индекса равно  jy. Если значение индекса выходит за границы допустимых значений, метод возвращает значение **false**. 
- **bool Max\_Field\_Im (int jy, ref double min, ref double max)**, который вычисляет минимальное и максимальное значения мнимой части поля в узлах сетки, для которых значение второго индекса равно  jy. Если значение индекса выходит за границы допустимых значений, метод возвращает значение **false**. 

В  классе  **V1DataArray**  определить  метод  **V1DataArray ToSmallerGrid(int  ns)**,  в  котором данные измерений пересчитываются на более мелкую сетку по оси **Ox**. 

Шаг  новой  сетки  равен  $`h_s = h_x(n_x − 1)/(n_s − 1)`$,   где  $n_s$  −  число  узлов  новой  сетки, $n_s > n_x$ . 

- Число узлов и шаг сетки по оси Oy не изменяются. 
- Для того, чтобы получить значения поля на более мелкой сетке по оси Ox, строятся интерполяционные кубические сплайны с узлами, совпадающими с узлами исходной сетки. Значения поля на более мелкой сетке вычисляются как значения интерполяционного сплайна. Используются интерполяционные кубические сплайны из математической библиотеки **Intel MKL**. 
- Так как процедуры Intel MKL для вычисления интерполяционных сплайнов работают с векторной функцией, пересчет значений для всех компонент поля надо выполнить в одном вызове процедуры из MKL.  
- Метод возвращает экземпляр **V1DataArray** с более мелкой сеткой по оси Ox и вычисленными значениями поля на сетке. Метод возвращает значение **null**, если не удалось создать экземпляр **V1DataArray** с более мелкой сеткой, например, при вызове процедур из библиотеки **Intel MKL** было брошено исключение. 

В среде VisualStudio надо cоздать решение (solution) с двумя проектами: 

1. тип одного проекта – консольное приложение **C#**;  
1. тип второго проекта – Dll-библиотека **C++**. 

В  Dll−библиотеке  **C++**  находится  глобальная  функция,  которая  вызывается  из  кода  **C#**  с использованием механизма **PInvoke.** Из этой глобальной функции  вызываются процедуры из математической библиотеки **Intel MKL**, необходимые для  построения интерполяционных кубических сплайнов. 

Через параметры глобальной функции из кода **C#** передаются данные, которые необходимы для построения интерполяционных кубических сплайнов и вычисления их значений. Через параметры глобальной функции в код **C#** возвращается код ошибки и вычисленные значения поля на новой сетке. 

## Отладка.

Для отладки в методе **Main()** надо создать объект типа **V1DataArray** с небольшим числом узлов.  Для  вычисления  значений  поля  в  узлах  сетки  в  конструкторе  объекта  выбрать полином третьей степени. 

Вызвать  метод  **V1DataArray ToSmallerGrid(int  ns)**  для  пересчета  значений  поля  на  более мелкую сетку. 

При  отладке  надо  выбрать  такое  число  узлов  новой  сетки,  чтобы  в  нее  вошли  все  узлы исходной сетки. Проверить, что значения поля в общих узлах исходной и новой сеток равны. 

Вывести максимальное и минимальное значения действительной и мнимой частей поля для исходной и более мелкой сетки для всех значений второго индекса **jy**. 

В программе должны быть обработаны все исключения, которые могут быть брошены при выполнении приложения. 
